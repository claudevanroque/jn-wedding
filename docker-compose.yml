version: '3.8'

services:
  web:
    build: .
    ports:
      - "8080:8080"
    environment:
      - SQLALCHEMY_DATABASE_URI=sqlite:///instance/wedding.db
      - SQLALCHEMY_TRACK_MODIFICATIONS=False
      - SECRET_KEY=${SECRET_KEY:-change-this-secret-key}
      - GOOGLE_SHEET_URL=${GOOGLE_SHEET_URL}
      - GOOGLE_CREDENTIALS_FILE=credentials.json
    volumes:
      # Mount instance directory to persist database
      - ./instance:/app/instance
      # Mount credentials file
      - ./credentials.json:/app/credentials.json:ro
      # Optional: mount .env file
      - ./.env:/app/.env:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
